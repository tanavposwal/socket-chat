<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container">
      <ul id="messages" class="list-group my-3"></ul>
      <form id="form" class="d-flex fixed-bottom mx-5 my-2" action="">
        <input id="input" autocomplete="off" class="form-control me-2" />
        <button type="button" class="btn btn-primary" id="send">Send</button>
      </form>
    </div>
  </body>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const name = prompt("Whats your name??");
    var socket = io();
    socket.emit("user login", {
      name: name,
    });
    var messages = document.getElementById("messages");
    var form = document.getElementById("form");
    var input = document.getElementById("input");
    var send = document.getElementById("send");

    send.addEventListener("click", () => {
      if (input.value) {
        // send event to server
        socket.emit("chat message", {
          name: name,
          msg: input.value,
        });
        input.value = "";
      }
    });

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if (input.value) {
        // send event to server
        socket.emit("chat message", {
          name: name,
          msg: input.value,
        });
        input.value = "";
      }
    });

    socket.on("chat message", (msg) => {
      if (msg.name == "$admin") {
        messages.innerHTML += `
        <li class="list-group-item">${msg.msg}</li>
      `;
      } else {
        messages.innerHTML += `
        <li class="list-group-item">${msg.name}: ${msg.msg}</li>
      `;
      }
      window.scrollTo(0, document.body.scrollHeight);
    });
  </script>
</html>
